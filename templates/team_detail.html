{% extends 'base.html' %}
{% block title %}–ö–æ–º–∞–Ω–¥–∞: {{ team.name }}{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto space-y-10">

  <!-- üë• –ö–æ–º–∞–Ω–¥–∞ -->
  <div class="team-info flex items-center gap-4 mb-6">
    {% if team.avatar_url %}
      <img src="{{ team.avatar_url }}" alt="–ê–≤–∞—Ç–∞—Ä –∫–æ–º–∞–Ω–¥—ã"
           class="rounded-full w-20 h-20 object-cover border border-gray-400">
    {% endif %}
    <div>
      <h1 class="text-3xl font-bold">{{ team.name }}</h1>
      {% if team.description %}
        <p class="text-gray-300 mt-1">{{ team.description }}</p>
      {% endif %}
    </div>
    <div class="ml-auto flex gap-2">
      {% if current_user.is_teamlead() %}
  <a href="{{ url_for('team_blueprint.edit_team') }}" class="btn">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É</a>
{% endif %}

      <form method="POST" action="{{ url_for('team_blueprint.leave_team') }}">
        <button class="btn btn-danger">–í—ã–π—Ç–∏</button>
      </form>
    </div>
  </div>

  <!-- üì® –ö–æ–¥ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è -->
  <div class="bg-zinc-800 p-4 rounded-xl border border-slate-700 space-y-2">
    <h2 class="text-lg font-semibold text-white">üì® –ö–æ–¥ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è</h2>
    <div class="flex gap-3 items-center">
      <input id="inviteCode" type="text" value="{{ team.invite_code }}" readonly
             class="w-full bg-zinc-700 text-white px-4 py-2 rounded border border-gray-600">
      <button type="button" onclick="copyInviteCode()" id="copyButton" class="btn btn-sm">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
    </div>
    <p class="text-sm text-slate-400">–û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–¥ –¥—Ä—É–≥–∏–º, —á—Ç–æ–±—ã –æ–Ω–∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å –∫ –≤–∞—à–µ–π –∫–æ–º–∞–Ω–¥–µ.</p>
  </div>

  <!-- üë§ –£—á–∞—Å—Ç–Ω–∏–∫–∏ -->
  <div>
    <h2 class="text-xl font-semibold text-white mb-3">–£—á–∞—Å—Ç–Ω–∏–∫–∏</h2>
    <ul class="space-y-2">
      {% for user in team.users %}
        <li class="bg-zinc-600 p-3 rounded flex justify-between items-center gap-4">
          <!-- –ê–≤–∞—Ç–∞—Ä -->
          <img src="{{ user.avatar or url_for('static', filename='default_avatar.png') }}"
               class="w-10 h-10 rounded-full object-cover flex-shrink-0" />
          
          <!-- –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
          <a href="{{ url_for('user_blueprint.view_profile', user_id=user.id) }}" 
             class="text-white hover:text-gray-300 flex-1 min-w-0 truncate">
              {{ user.username }}
          </a>
          
          <!-- –†–æ–ª—å -->
          {% if current_user.is_teamlead() and user.id != current_user.id %}
            <form method="POST" action="{{ url_for('team_blueprint.add_team_member', team_id=team.id) }}" class="flex items-center w-40">
              <input type="hidden" name="user_id" value="{{ user.id }}">
              <select name="role_id" class="bg-slate-800 text-xs text-white border border-slate-600 rounded p-1 w-full" onchange="this.form.submit()">
                <option value="">–ë–µ–∑ —Ä–æ–ª–∏</option>
                {% for role in roles %}
                  {% if role.name != 'Admin' and role.name != 'TeamLead' %}
                    <option value="{{ role.id }}" {% if user.role and user.role.id == role.id %}selected{% endif %}>{{ role.name }}</option>
                  {% endif %}
                {% endfor %}
              </select>
            </form>
          {% else %}
            <p class="text-xs text-slate-400 w-24 text-center">{{ user.role.name if user.role else '–ë–µ–∑ —Ä–æ–ª–∏' }}</p>
          {% endif %}
          
          <!-- –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è -->
          {% if current_user.is_teamlead() and user.id != current_user.id %}
          <a href="{{ url_for('team_blueprint.remove_team_member', team_id=team.id, user_id=user.id) }}"
             class="text-red-400 hover:underline text-sm flex-shrink-0">
             –£–¥–∞–ª–∏—Ç—å
          </a>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  </div>
</div>

<script>
  async function copyInviteCode() {
    const input = document.getElementById("inviteCode");
    const button = document.getElementById("copyButton");
    
    try {
      await navigator.clipboard.writeText(input.value);
      
      // –í–∏–∑—É–∞–ª—å–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
      button.innerHTML = '‚úì –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ';
      button.classList.add('bg-green-600');
      button.classList.remove('bg-gray-600');
      
      // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –≤–∏–¥ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
      setTimeout(() => {
        button.innerHTML = 'üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å';
        button.classList.add('bg-gray-600');
        button.classList.remove('bg-green-600');
      }, 2000);
      
    } catch (err) {
      console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ', err);
      // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
      input.select();
      document.execCommand('copy');
      
      button.innerHTML = '‚úì –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ (—Å—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥)';
      setTimeout(() => {
        button.innerHTML = 'üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å';
      }, 2000);
    }
  }
</script>
{% endblock %}