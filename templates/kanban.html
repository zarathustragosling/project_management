{% extends 'base.html' %}
{% block title %}Kanban-доска{% endblock %}

{% block content %}
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

<div class="container">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold">Kanban-доска</h1>
        <a href="{{ url_for('task_creator') }}" class="btn">+ Создать задачу</a>
    </div>

    <div class="kanban-board">
        <!-- To Do Column -->
        <div class="kanban-column" id="TO_DO-column">
            <h2 class="text-xl font-semibold mb-2">To Do</h2>
            <div class="kanban-items">
                {% for task in tasks if task.status.value == 'To Do' %}
                <div class="task-card {{ 'high-priority' if task.priority == 'Высокий' else 'medium-priority' if task.priority == 'Средний' else 'low-priority' }}" data-task-id="{{ task.id }}">
                    <h3><a href="{{ url_for('task_detail', task_id=task.id) }}">{{ task.title }}</a></h3>
                    <p>Проект: <a href="{{ url_for('project_detail', project_id=task.project_id) }}">{{ task.project.name }}</a></p>
                    <p><strong>Ответственный:</strong> {{ task.assigned_user.username if task.assigned_user else "Не назначен" }}</p>
                    <p><strong>Постановщик:</strong> {{ task.creator.username }}</p>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- In Progress Column -->
        <div class="kanban-column" id="IN_PROGRESS-column">
            <h2 class="text-xl font-semibold mb-2">In Progress</h2>
            <div class="kanban-items">
                {% for task in tasks if task.status.value == 'In Progress' %}
                <div class="task-card {{ 'high-priority' if task.priority == 'Высокий' else 'medium-priority' if task.priority == 'Средний' else 'low-priority' }}" data-task-id="{{ task.id }}">
                    <h3><a href="{{ url_for('task_detail', task_id=task.id) }}">{{ task.title }}</a></h3>
                    <p>Проект: <a href="{{ url_for('project_detail', project_id=task.project_id) }}">{{ task.project.name }}</a></p>
                    <p><strong>Ответственный:</strong> {{ task.assigned_user.username if task.assigned_user else "Не назначен" }}</p>
                    <p><strong>Постановщик:</strong> {{ task.creator.username }}</p>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Done Column -->
        <div class="kanban-column" id="DONE-column">
            <h2 class="text-xl font-semibold mb-2">Done</h2>
            <div class="kanban-items">
                {% for task in tasks if task.status.value == 'Done' %}
                <div class="task-card {{ 'high-priority' if task.priority == 'Высокий' else 'medium-priority' if task.priority == 'Средний' else 'low-priority' }}" data-task-id="{{ task.id }}">
                    <h3><a href="{{ url_for('task_detail', task_id=task.id) }}">{{ task.title }}</a></h3>
                    <p>Проект: <a href="{{ url_for('project_detail', project_id=task.project_id) }}">{{ task.project.name }}</a></p>
                    <p><strong>Ответственный:</strong> {{ task.assigned_user.username if task.assigned_user else "Не назначен" }}</p>
                    <p><strong>Постановщик:</strong> {{ task.creator.username }}</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
