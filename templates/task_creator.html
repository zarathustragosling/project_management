{% extends 'base.html' %}
{% block title %}{{ 'Редактировать задачу' if is_edit else 'Создать задачу' }}{% endblock %}

{% block content %}
<div class="container">
    <h1 class="text-2xl font-bold mb-6">{{ 'Редактировать задачу' if is_edit else 'Создание задачи' }}</h1>

    <form method="POST" action="{{ url_for('edit_task', task_id=task.id) if is_edit else url_for('task_creator') }}" class="task-form">
        <div class="form-group">
            <label for="title">Название задачи</label>
            <input type="text" name="title" id="title" value="{{ task.title if is_edit else '' }}" required>
        </div>

        <div class="form-group">
            <label for="description">Описание</label>
            <textarea name="description" id="description">{{ task.description if is_edit else '' }}</textarea>
        </div>

        <div class="form-group">
            <label for="priority">Приоритет</label>
            <select name="priority" id="priority">
                <option value="Высокий" {% if is_edit and task.priority == 'Высокий' %}selected{% endif %}>Высокий</option>
                <option value="Средний" {% if is_edit and task.priority == 'Средний' %}selected{% endif %}>Средний</option>
                <option value="Низкий" {% if is_edit and task.priority == 'Низкий' %}selected{% endif %}>Низкий</option>
            </select>
        </div>

        <div class="form-group">
            <label for="status">Статус</label>
            <select name="status" id="status">
                {% for st in ['To Do', 'In Progress', 'Done'] %}
                    <option value="{{ st }}" {% if is_edit and task.status.value == st %}selected{% endif %}>{{ st }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label for="project_id">Проект</label>
            <select name="project_id" id="project_id" required>
                {% for project in projects %}
                    <option value="{{ project.id }}" {% if is_edit and task.project_id == project.id %}selected{% endif %}>
                        {{ project.name }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label for="assigned_to">Ответственный</label>
            <select name="assigned_to" id="assigned_to">
                <option value="">Не назначен</option>
                {% for user in users %}
                    <option value="{{ user.id }}" {% if is_edit and task.assigned_to == user.id %}selected{% endif %}>
                        {{ user.username }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label for="deadline">Крайний срок</label>
            <input type="date" name="deadline" id="deadline"
                   value="{{ task.deadline.strftime('%Y-%m-%d') if is_edit and task.deadline else '' }}">
        </div>
       
        <div class="form-group">
            <label for="created_at">Дата создания</label>
            <input type="date" name="created_at" id="created_at"
                   value="{% if is_edit and task.created_at %}{{ task.created_at.strftime('%Y-%m-%d') }}{% else %}{{ current_date }}{% endif %}">
          </div>
          
        
        <button type="submit" class="btn-primary">
            {{ 'Сохранить' if is_edit else 'Создать задачу' }}
        </button>
    </form>
</div>
{% endblock %}
